# Прогнозирование оттока клиентов фитнес-клуба методами машинного обучения

**Заказчик** - сеть фитнес-центров "Культурист-датасаентист"

**Задачи** - провести анализ и спрогнозировать отток пользователя, подготовить план действий по удержанию клиентов

**Stack** -  Matplotlib,Pandas,Python,Scikit-learn,Seaborn,классификация,кластеризация,машинное обучение

Данные  - ``, где:

Данные клиента за предыдущий до проверки факта оттока месяц:

- 'gender' — пол;
- 'Near_Location' — проживание или работа в районе, где находится фитнес-центр;
- 'Partner' — сотрудник компании-партнёра клуба (сотрудничество с компаниями, чьи сотрудники могут получать скидки на абонемент — в таком случае фитнес-центр хранит информацию о работодателе клиента);
- Promo_friends — факт первоначальной записи в рамках акции «приведи друга» (использовал промо-код от знакомого при оплате первого абонемента);
- 'Phone' — наличие контактного телефона;
- 'Age' — возраст;
- 'Lifetime' — время с момента первого обращения в фитнес-центр (в месяцах).

Информация на основе журнала посещений, покупок и информация о текущем статусе абонемента клиента:

- 'Contract_period' — длительность текущего действующего абонемента (месяц, 6 месяцев, год);
- 'Month_to_end_contract' — срок до окончания текущего действующего абонемента (в месяцах);
- 'Group_visits' — факт посещения групповых занятий;
- 'Avg_class_frequency_total' — средняя частота посещений в неделю за все время с начала действия абонемента;
- 'Avg_class_frequency_current_month' — средняя частота посещений в неделю за предыдущий месяц;
- 'Avg_additional_charges_total' — суммарная выручка от других услуг фитнес-центра: кафе, спорттовары, косметический и массажный салон.
- 'Churn' — факт оттока в текущем месяце.

## Итоги работы
Перед нами стояла задача бинарной классификации, где целевой признак - факт оттока клиента в следующем месяце.

Эту задачу можно решить методами машинного обучения с помощью алгоритмов логистической регрессии и ансамбля "случайный лес", а также с помощью кластеризации клиентов. 

От заказчика получили данные, обработали их и уже на первом этапе выявили особенности и некоторые предпосылки будущего оттока и снижения выручки:
1. 75% клиентов имеют краткосрочные абонементы всего на 1 месяц. Почему? (Акционная цена на 1 месяц? - поработать с ценообразованием и сделать наиболее выгодными длинные годичные абонементы. Подключить возможность приобретения абонементов в рассрочку с помощью банков)
2. 25% пользуются копоративным посещением и 25% пришли по рекомендации друга - хороший показатель работы "сарафанного радио" и работы отдела продаж корпоративным клиентам.
3. Всего четверть клиентов посещают групповые занятия - это низкий показатель, ведь благодаря групповым занятиям складывается сообщество посещающих разные классы, растет вовлеченность клиентов в коллектив и фитнес-клуб в целом. Возможно , групповые занятия стоят в неудобное для большинства время. Необходимо выделить наиболее удобное вермя для посещения групповых занятий, например, провести анкетирование клиентов, собрать жалобы и предложения.
4. Возраст клиентов от 18 до 41 года. А где люди старше 41 года? Недоработка отдела маркетинга по привлечению клиентов старшего возраста? Предпенсионерами и пенсионерами можно заполнить дневные групповые занятия. (Для работы с клиентами младше 18 лет необходимы отдельные условия, если они есть, то отделу маркетинга необходимо привлекать и их, например, в анкетах регистрации сделать поле выбора "дети" и далее при заполненном поле взаимодействовать с этими клиентами)
Также возраст в 41 год можно объяснить спецификой фитнес-клуба : наличие сложных программ и тренажеров, требующих профессиональной подготовки и отличных физических данных, которыми люди старшего возраста часто не обладают. (Или тем, что 20 лет назад "Датасаентистов" попросту не было))
5. У большинства клиентов в текущем или следующем месяце закончится абонемент - это создает неопределенность в прогнозировании выручки. Решение - специальные предложения для тех, у кого заканчивается абонемент; продажа долгосрочных абонементов (по привлекательной цене и /или в рассрочку)
6. Большинство клиентов впервые посетило данную сеть фитнес-клубов меньше года назад. (Клуб открылся недавно или клиенты по каким-то причинам не продлевают годовые абонементы?)

Составили портрет "отвалившегося" клиента :
* живет дальше от клуба,
* пришел не по корпоративной программе
* пришел не по приглашению друга
* средний срок абонемента 1-3 месяца
* посещает групповые занятия в 2 раза реже тех, кто продолжает ходить в клуб
* средний возраст 27 лет (более молодой)
* заканчивает ходить ДО окончания абонемента (Lifetime < Month_to_end_contract)
* тратит на дополнительные услуги на 30% меньше
* в 2 раза реже ходит в клуб, чем те, кто продолжает ходить.

То есть молодой человек (независимо от пола) пришел сам, купил абонемент на короткий срок, ходил 1 раз в неделю, практически не ходил на групповые занятия, сказал об окончании посещения до окончания абонемента (возможно, обратился за возвратом средств за неиспользованное время).

Для выбора модели прогнозирования оттока необходимо знать "себестоимость" каждого маркетингового взаимодействия с клиентом, учитывать бюджет и ресурсы компании. 

Если бюджет позволяет, и клиент "приносит" больше выручки, чем затрат на него, то ориентируемся на Recall. 
Если отдел маркетинга еще не полностью оцифрован и бюджет ограничен и не всегда эффективен, то на Precision.

Определим, какую модель выбрать, учитывая:
1. Так как нам важно снизить отток клиентов, то важна метрика Recall, так как лучше повзаимодействием даже с тем клиентом, который не хочет уходить из фитнес-клуба. (Он узнает о новых предложениях клуба)
2. Так как все взаимодействия с клиентом увеличивают затраты ресурсов (персонала, финансовые), то важна метрика Precision, то есть ориентированность только на тех, кто точно (по прогнозам) уйдет. 

Так как большинство клиентов приходят на 1 месяц (видимо, выгодная цена), а также действуют корпоративные программы и акция "приведи друга", то делаем вывод , что маркетинговый бюджет есть, ресурсы есть. Также имеем в виду, что финансовая модель бизнеса предполагает, что клиент приносит выручку, превышающую затраты на его обслуживание, то ориентируемся на Recall.

В процессе кластеризации строили дендрограмму по разным датасетам. По очищенным данным модель определяет 2 кластера, по нормальным данным - 4. 

Модель кластеризации на основании алгоритма KMeans при очищенных данных также имеет более низкое качество, поэтому прогнозирование осуществлялось по нормальным данным их gym_normal и делением на 5 кластеров.

Максимальное среднее значение оттока клиентов имеют кластеры №3 (56,4) и №2 (0,403), при этом у них :
* малая средняя частота посещений за неделю (1,2 и 1,59)
* минимальный Lifetime (1,9 и 2,97)
* самый молодой возраст (27,5 и 28,6)
* реже посещают групповые занятия, чем остальные кластеры
* самый короткий абонемент

Видим, что на ПРОГНОЗ оттока 'predict_churn' наибольшее влияние имеет обратная корреляция с 'Promo_friends' (-0.63), 'Phone' (-0.54), 'Partner' (-0.35) и 'Near_Location' (0,18), то есть признаки социальных связей оказывают обратное воздействие на отток клиентов, то есть клиенты, общающиеся с другими, не так часто уходят из фитнес-клуба. Важно создавать сообщество, коллектив, например, на групповых программах,  устраивать мероприятия в клубе для знакомства участников. Фактор близости иногда играет в обратном направлении, кажется, что клуб близко и "всегда успею сходить".

На ФАКТ оттока 'Churn' наибольшее влияние имеет обратная корреляция с 'Lifetime' (-0,44), 'Avg_class_frequency_current_month' (-0,41), 'Age' (-0,4), 'Contract_period' (-0,39), то есть молодой возраст, редкое посещение, короткий абонемент не способствуют продолжить посещение.


Также по поводу ML видим, что разные алгоритмы и модели ведут себя по-разному на одних и тех же данных. И подобрать верную и работающую модель - по-истине искусство и нелегкий труд.
